<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<template id="report_sales_agent">
		<t t-call="web.html_container">
			<t t-foreach="docs" t-as="o">
				<t t-call="web.external_layout">
					<div class="page mx-n2 my-n0">
						<div class="h3 p-2 m-0 font-weight-bold text-center">Sales Agent Report</div>
						<t t-set="total_quote_dict" t-value="{}"/>
						<table width="100%" class="table table-sm o_main_table" style="font-size: 0.9rem; color: #000000; border-left: none; border-right:none;">
							<thead>
								<tr>
									<th style="border-left: none;" class="text-center">Date</th>
									<th class="text-center">Quote&amp;nbsp;Number</th>
									<th class="text-center">Customer</th>
									<th class="text-center" width="100px">Status</th>
									<th class="text-center">Estd.&amp;nbsp;Total&amp;nbsp;Revenue</th>
									<th class="text-center">Estd.&amp;nbsp;Total&amp;nbsp;Cost</th>
									<th style="border-right:none;" class="text-center">Estd.&amp;nbsp;Profit</th>
								</tr>
							</thead>
							<tbody style="color: #000000;">
								<t t-foreach="data['users_name']" t-as="u_name">
									<t t-set="users" t-value="o.env['res.users'].browse(int(u_name))"/>
									<t t-set="user_name" t-value="users.name"/>
									<t t-set="estimated_total_revenue" t-value="0.0"/>
									<t t-set="estimated_total_cost" t-value="0.0"/>
									<t t-set="estimated_profit" t-value="0.0"/>
									<t t-set="user_quote_total" t-value="0"/>
									<t t-foreach="data['quote_list']" t-as="quote">
										<t t-if="quote['user_name'] == u_name">
											<t t-set="estimated_total_revenue" t-value="estimated_total_revenue + quote['estimated_total_revenue']"/>
											<t t-set="estimated_total_cost" t-value="estimated_total_cost + quote['estimated_total_cost']"/>
											<t t-set="estimated_profit" t-value="estimated_profit + quote['estimated_profit']"/>
											<t t-set="user_quote_total" t-value="user_quote_total + 1"/>
										</t>
									</t>
									<t t-esc="total_quote_dict.update({user_name:user_quote_total})"/>
									<tr class="bg-400 border-bottom border-dark">
										<td colspan="7" class="font-weight-bold" style="border-right:none;"><span t-esc="user_name"/> (<span t-esc="user_quote_total"/>)</td>
									</tr>
									<t t-foreach="data['quote_list']" t-as="quote">
										<tr>
											<t t-if="quote['user_name'] == u_name">
												<td><span t-esc="quote['date']" t-options="{'widget': 'date'}"/></td>
												<td><span t-esc="quote['name']"/></td>
												<td><span t-esc="quote['customer']"/></td>
												<td class="text-center"><span t-esc="quote['status']"/></td>
												<td class="text-right"><span t-esc="quote['estimated_total_revenue']" t-options='{"widget": "float", "precision": 2}'/></td>
												<td class="text-right"><span t-esc="quote['estimated_total_cost']" t-options='{"widget": "float", "precision": 2}'/></td>
												<td class="text-right" style="border-right:none;"><span t-esc="quote['estimated_profit']" t-options='{"widget": "float", "precision": 2}'/></td>
											</t>
										</tr>
									</t>
									<tr class="bg-600 border-bottom border-dark font-weight-bold">
										<td colspan="3"></td>
										<td class="text-right">Total</td>
										<td class="text-right"><span t-esc="estimated_total_revenue" t-options='{"widget": "float", "precision": 2}'/></td>
										<td class="text-right"><span t-esc="estimated_total_cost" t-options='{"widget": "float", "precision": 2}'/></td>
										<td class="text-right" style="border-right:none;"><span t-esc="estimated_profit" t-options='{"widget": "float", "precision": 2}'/></td>
									</tr>
								</t>
							</tbody>
						</table>

						<div style="page-break-after: always;"><br/></div>
						<t t-set="total_estimated_total_revenue" t-value="0.0"/>
						<t t-set="total_estimated_total_cost" t-value="0.0"/>
						<t t-set="total_quote" t-value="0"/>
						<t t-foreach="data['users_name']" t-as="u_name">
							<t t-set="users" t-value="o.env['res.users'].browse(int(u_name))"/>
							<t t-set="user_name" t-value="users.name"/>
							<t t-set="estimated_total_revenue" t-value="0.0"/>
							<t t-set="estimated_total_cost" t-value="0.0"/>
							<t t-foreach="data['quote_list']" t-as="quote">
								<t t-if="quote['user_name'] == u_name">
									<t t-set="total_estimated_total_revenue" t-value="total_estimated_total_revenue + quote['estimated_total_revenue']"/>
									<t t-set="total_estimated_total_cost" t-value="total_estimated_total_cost + quote['estimated_total_cost']"/>
									<t t-set="total_quote" t-value="total_quote + 1"/>
								</t>
							</t>
						</t>
						<br/>
						<div class="row" style="font-size: 15px;">
							<div class="col-6">
								<div class="p-4">
									<table class="table table-sm" style="font-size: 0.9rem; color: #000000;">
										<thead>
											<tr class="report-bg-primary">
												<th colspan="3" class="font-weight-bold bg-300">Sales Team Summary</th>
											</tr>
											<tr>
												<th>Sales&amp;nbsp;Team</th>
												<th width="150px">Quote&amp;nbsp;Count</th>
												<th width="150px">Estimated&amp;nbsp;Profit</th>
											</tr>
										</thead>
										<tbody style="color: #000000;">
											<tr t-foreach="data['users_name']" t-as="u_name">
												<t t-set="users" t-value="o.env['res.users'].browse(int(u_name))"/>
												<t t-set="user_name" t-value="users.name"/>
												<t t-set="estimated_profit" t-value="0.0"/>
												<t t-foreach="data['quote_list']" t-as="quote">
													<t t-if="quote['user_name'] == u_name">
														<t t-set="estimated_profit" t-value="round(estimated_profit + quote['estimated_profit'], 2)"/>
													</t>
												</t>
												<td class="px-2"><span t-esc="user_name"/></td>
												<td class="px-2 text-right"><span t-esc="total_quote_dict[user_name]"/></td>
												<td class="px-2 text-right"><span t-esc="estimated_profit"/></td>
											</tr>
											<tr>
												<td colspan="2" class="border-top font-weight-bold border-dark text-right">Total Estimated Profit</td>
												<td class="font-weight-bold border-top border-dark report-bg-primary text-right text-decoration-underline"><span t-esc="total_estimated_total_revenue - total_estimated_total_cost" t-options='{"widget": "float", "precision": 2}'></span></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
							<div class="col-6">
								<div class="p-4">
									<table class="table table-sm" style="font-size: 0.9rem; color: #000000;">
										<thead>
											<tr class="bg-300">
												<th colspan="2" class="font-weight-bold">Total Summary</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td class="font-weight-bold">Estimated Total Revenue</td>
												<td class="text-right">
													<span t-esc="total_estimated_total_revenue" t-options='{"widget": "float", "precision": 2}'></span>
												</td>
											</tr>
											<tr>
												<td class="font-weight-bold">Estimated Total Cost</td>
												<td class="text-right">
													<span t-esc="total_estimated_total_cost" t-options='{"widget": "float", "precision": 2}'></span>
												</td>
											</tr>
											<tr>
												<td class="font-weight-bold">Estimated Profit</td>
												<td class="text-right">
													<u><span style="font-weight:bold;text-decoration:underline;" t-esc="total_estimated_total_revenue - total_estimated_total_cost" t-options='{"widget": "float", "precision": 2}'></span></u>
												</td>
											</tr>
											<tr>
												<td colspan="2" class="report-bg-primary text-center border-top border-dark text-dark">
													<span><b>TOTAL CONFIRMED JOBS</b></span><br/>
													<h4 class="p-0 m-0 font-weight-bold"><span t-esc="total_quote"/></h4>
												</td>
											</tr>
											<tr>
												<td colspan="2" class="text-left border-top border-dark text-dark" style="padding:0.5rem !important;font-size:15px;">
													<h5><b>Remarks:</b></h5>
													<p><span t-esc="data['remarks']"/></p>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</t>
			</t>
		</t>
	</template>
</odoo>
