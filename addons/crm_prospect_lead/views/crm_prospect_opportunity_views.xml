<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="crm_prospect_opportunity_view_form" model="ir.ui.view">
        <field name="name">crm_prospect_opportunity.view.form</field>
        <field name="model">crm.prospect.opportunity</field>
        <field name="arch" type="xml">
            <form string="Opportunity">
                <header>
                    <button string="Change Status" name="action_change_status"
                        type="object" class="oe_highlight" />
                    <field name="stage_id" widget="statusbar" clickable="0"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <label for="name" name="oe_inline"/>
                        <h1><field name="name" class="oe_inline" force_save="1" readonly="1"/></h1>
                    </div>
                    <group name="header">
                        <group name="opportunity_left">
                            <field name="date" />
                            <field name="location_id" />
                            <field name="is_create_from_lead" invisible="1"/>
                            <field name="lead_id" attrs="{'readonly': ['|', ('id', '&gt;', 0), ('is_create_from_lead', '=', True)]}" force_save="1" groups="fm_sale_crm.group_salesman,freight_base.group_manage_pricing"/>
                            <field name="team_id" options="{'no_create': True}" required="1"/>
                        </group>
                        <group name="opportunity_right">
                            <field name="opportunity_source" widget="radio" options="{'horizontal': True}"/>
                            <field name="opportunity_type" widget="radio" options="{'horizontal': True}"/>
                            <field name="opportunity_for" widget="radio" options="{'horizontal': True}"/>
                            <field name="user_id" options="{'no_create': True, 'no_open': True}" context="{'access_all_team_member': True, 'team_id': team_id}"/>
                            <field name="company_id" options="{'no_create': True, 'no_open': True}"/>
                            <field name="pricing_team_id" options="{'no_create': True, 'no_open': True}"/>
                            <field name="agent_id" options="{'no_create': True, 'no_open': True}"/>
                        </group>
                    </group>
                    <separator string="Shipment Details" name="shipment_detail_label"/>
                    <group name="shipment_details">
                        <group name="shipment_details_left">
                            <field name="transport_mode_id" options="{'no_create': True}" attrs="{'required': [('opportunity_for', '=', 'shipment')]}"/>
                            <field name="cargo_type_domain" invisible="1" />
                            <field name="cargo_type_id"  domain="cargo_type_domain" options="{'no_create': True}" attrs="{'required': [('opportunity_for', '=', 'shipment')]}"/>
                            <field name="commodity_id" options="{'no_create': True}" />
                            <field name="shipment_due_date" />
                            <field name="cargo_status" options="{'horizontal': true}" widget="radio"/>
                            <field name="is_package_group" invisible="1"></field>
                            <field name="incoterm_check" invisible="1"></field>
                            <field name="pickup_address" attrs="{'invisible': ['|',('opportunity_for','!=','shipment'),('incoterm_check', '!=', True)]}"/>
                        </group>
                        <group name="shipment_details_right">
                            <field name="shipment_type_id" options="{'no_create': True}"/>
                            <field name="incoterm_id" options="{'no_create': True}" attrs="{'required': [('opportunity_for', '=', 'shipment')]}"/>
                            <field name="service_mode_id" options="{'no_create': True}"/>
                            <field name="cargo_description" />
                            <field name="delivery_address" attrs="{'invisible': ['|',('opportunity_for','!=','shipment'),('incoterm_check', '!=', True)]}"/>
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="mode_type" invisible="1"/>
                            <field name="opp_check" invisible="1"/>
                            <field name="origin_country_id" string="Origin Country" options="{'no_create': True}"/>
                            <field name="origin_un_location_id" context="{'default_country_id': origin_country_id}" />
                            <div class="o_td_label">
                                <label for="port_of_loading_id"  string="Origin Port" attrs="{'invisible': [('mode_type','=','air')]}"/>
                                <label for="port_of_loading_id"  string="Origin Airport" attrs="{'invisible': [('mode_type','!=','air')]}"/>
                            </div>
                            <field name="port_of_loading_id" domain="loading_port_domain" context="{'default_country_id': origin_country_id}" nolabel="1" options="{'no_create': True}" attrs="{'required': [('opportunity_for', '=', 'shipment'),('mode_type', 'in', ['sea', 'air'])]}"/>
                            <field name="loading_port_domain" invisible="1"/>
                        </group>
                        <group>
                            <field name="destination_country_id" options="{'no_create': True}"/>
                            <field name="destination_un_location_id" context="{'default_country_id': destination_country_id}"/>
                            <div class="o_td_label">
                                <label for="port_of_discharge_id"  string="Destination Port" attrs="{'invisible': [('mode_type','=','air')]}"/>
                                <label for="port_of_discharge_id"  string="Destination Airport" attrs="{'invisible': [('mode_type','!=','air')]}"/>
                            </div>
                            <field name="port_of_discharge_id" domain="discharge_port_domain" context="{'default_country_id': destination_country_id}" nolabel="1" options="{'no_create': True}" attrs="{'required': [('mode_type', 'in', ['sea', 'air'])]}"/>
                            <field name="discharge_port_domain" invisible="1"/>
                        </group>
                    </group>
                    <group name="party_details" string="Party Details">
                        <group name="party_details_left">
                            <label for="customer_id" string="Customer"/>
                            <field name="customer_id" nolabel="1" required="1"/>
                            <field name="customer_type" widget="radio" options="{'horizontal': True}"/>
                            <label for="partner_id" string="" attrs="{'invisible': [('opportunity_type', '!=', 'existing')]}"/>
                            <field name="partner_id" nolabel="1" attrs="{'invisible': [('opportunity_type', '!=', 'existing')], 'required': [('opportunity_type', '=', 'existing')]}"/>
                            <label for="prospect_id" string="" attrs="{'invisible': [('opportunity_type', '!=', 'new')]}"/>
                            <field name="prospect_id" nolabel="1" attrs="{'invisible': [('opportunity_type', '!=', 'new')], 'required': [('opportunity_type', '=', 'new')]}"/>
                            <label for="street1" string="Address"/>
                            <div class="o_address_format">
                                <field name="street1" required="1" placeholder="Street 1..." class="o_address_street"/>
                                <field name="street2" placeholder="Street 2..." class="o_address_street"/>
                                <field name="country_id" required="1" placeholder="Country" class="o_address_country" options="{'no_create': True,'no_open':True}"/>
                                <field name="state_id" class="o_address_state" placeholder="State" options="{'no_create': True,'no_open':True}"/>
                                <field name="city_id" placeholder="City" class="o_address_city" options="{'no_open':True}"
                                    domain="[('country_id','=',country_id),('state_id','=',state_id)]"
                                    context="{'default_country_id':country_id,'default_state_id':state_id,'default_zipcode':zip}"/>
                                <field name="zip" placeholder="ZIP" class="o_address_zip"/>
                            </div>
                        </group>
                        <group name="party_details_right">
                            <field name="contact_name" />
                            <field name="designation" />
                            <field name="department" />
                            <field name="email" widget="email"/>
                            <field name="phone" widget="phone"/>
                            <field name="mobile" widget="phone"/>
                        </group>
                    </group>
                    <group name="customer_visit_information" string="Customer Visit Information">
                        <field name="customer_visit_ids" nolabel="1">
                            <tree>
                                <field name="serial_no"/>
                                <field name="date_of_visit"/>
                                <field name="communication_mode" optional="show"/>
                                <field name="time_of_visit"/>
                                <field name="visited_by_id"/>
                                <field name="purpose_of_visit" optional="show"/>
                                <field name="next_visit"/>
                                <field name="next_followup_date"/>
                                <field name="assign_to_id"/>
                                <field name="notes"/>
                                <field name="company_id" invisible="1"/>
                                <field name="customer_id" invisible="0"/>
                                <field name="user_id" invisible="1"/>
                            </tree>
                        </field>
                    </group>
                    <group string="Additional Services" attrs="{'invisible': [('opportunity_for', '!=', 'shipment')]}">
                        <field name="additional_service_ids" widget="many2many_tags" nolabel="1" options="{'no_create': True}"/>
                    </group>
                    <notebook attrs="{'invisible': [('opportunity_for', '!=', 'shipment')]}">
                        <page name="cargo_details" string="Packages" attrs="{'invisible': [('is_package_group', '=', False)]}">
                            <field name="package_ids">
                                <tree>
                                    <field name="quantity" />
                                    <field name="package_uom_id"/>
                                    <field name="weight" />
                                    <field name="weight_uom_id" />
                                    <field name="volume" />
                                    <field name="volume_uom_id" />
                                    <field name="total_weight" />
                                    <field name="total_weight_uom_id" />
                                    <field name="total_volume" />
                                    <field name="total_volume_uom_id" />
                                </tree>
                                <form>
                                    <group>
                                        <group>
                                            <div class="o_td_label">
                                                <label for="quantity" />
                                            </div>
                                            <div class="o_row">
                                                <field name="quantity" placeholder="Quantity" />
                                                <field name="package_uom_id" placeholder="Package UoM" options="{'no_create': True}"/>
                                            </div>
                                            <field name="calculated_dimension_lwh" invisible="1"/>
                                            <label for="length" string="Dimensions (L-W-H)" attrs="{'invisible': [('calculated_dimension_lwh', '!=', True)]}"/>
                                            <div class="o_row" attrs="{'invisible': [('calculated_dimension_lwh', '!=', True)]}">
                                                <field name="length" />x
                                                <field name="width" />x
                                                <field name="height" />
                                                <field name="lwh_uom_id" options="{'no_create': True}"/>
                                            </div>
                                            <label for="divided_value" string="Divided Value" attrs="{'invisible': [('calculated_dimension_lwh', '!=', True)]}"/>
                                            <div class="o_row" attrs="{'invisible': [('calculated_dimension_lwh', '!=', True)]}">
                                                <field name="divided_value" force_save="1" readonly="1"/>
                                            </div>
                                        </group>
                                    </group>
                                    <group>
                                        <group>
                                            <div class="o_td_label">
                                                <label for="weight" />
                                            </div>
                                            <div class="o_row">
                                                <field name="weight"></field>
                                                <field name="weight_uom_id" placeholder="Weight UoM" options="{'no_create': True}"/>
                                            </div>
                                        </group>
                                        <group>
                                            <div class="o_td_label">
                                                <label for="volume" />
                                            </div>
                                            <div class="o_row">
                                                <field name="volume"></field>
                                                <field name="volume_uom_id" placeholder="Volume UoM" options="{'no_create': True}"/>
                                            </div>
                                        </group>
                                    </group>
                                    <group>
                                        <group>
                                            <div class="o_td_label">
                                                <label for="total_weight" />
                                            </div>
                                            <div class="o_row">
                                                <field name="total_weight"></field>
                                                <field name="total_weight_uom_id" placeholder="Total Weight UoM" options="{'no_create': True}" />
                                            </div>
                                        </group>
                                        <group>
                                            <div class="o_td_label">
                                                <label for="total_volume" />
                                            </div>
                                            <div class="o_row">
                                                <field name="total_volume"></field>
                                                <field name="total_volume_uom_id" placeholder="Total Volume UoM" options="{'no_create': True}"/>
                                            </div>
                                        </group>
                                    </group>
                                </form>
                            </field>
                        </page>
                        <page name="container_details" string="Packages" attrs="{'invisible': ['|', ('opportunity_for', '!=', 'shipment'), ('is_package_group', '=', True)]}">
                            <field name="container_ids">
                                <tree editable="bottom">
                                    <field name="container_type_id" options="{'no_create': True}" context="{'default_container_mode': parent.transport_mode_id}" width="10"
                                        domain="[('transport_mode_id', '=', parent.transport_mode_id)]"/>
                                    <field name="quantity" width="10"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record id="crm_prospect_opportunity_view_tree" model="ir.ui.view">
        <field name="name">crm_prospect_opportunity.view.tree</field>
        <field name="model">crm.prospect.opportunity</field>
        <field name="arch" type="xml">
            <tree string="Opportunity">
                <field name="name" string="Opportunity Number"/>
                <field name="date"/>
                <field name="location_id"/>
                <field name="prospect_id"/>
                <field name="opportunity_for"/>
                <field name="transport_mode_id"/>
                <field name="shipment_type_id"/>
                <field name="incoterm_id" string="Incoterms"/>
                <field name="user_id" string="Sales Agent"/>
                <field name="stage_id"/>
            </tree>
        </field>
    </record>

    <record id="crm_prospect_opportunity_view_search" model="ir.ui.view">
        <field name="name">crm_prospect_opportunity.view.search</field>
        <field name="model">crm.prospect.opportunity</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"></field>
                <field name="date"></field>
                <field name="location_id"></field>
                <field name="prospect_id"></field>
                <field name="opportunity_for"/>
                <field name="transport_mode_id"></field>
                <field name="shipment_type_id"></field>
                <field name="incoterm_id" ></field>
                <field name="user_id"></field>
                <field name="stage_id"></field>
                <field name="opportunity_type"/>
                <field name="opportunity_for"/>
                <separator/>
                <filter name="date" string="Date" date="date"/>
                <separator/>
                <group expand="0" name="group_by" string="Group By">
                    <filter name="group_prospect_id" string="Customer" context="{'group_by': 'prospect_id'}"/>
                    <filter name="group_date" string="Date" context="{'group_by': 'date'}"/>
                    <filter name="group_user_id" string="Sales Agent" context="{'group_by': 'user_id'}"/>
                    <filter name="group_stage" string="Opportunity Stages" context="{'group_by': 'stage_id'}"/>
                    <filter name="group_transport_mode" string="Transport Mode" context="{'group_by': 'transport_mode_id'}"/>
                    <filter name="group_opportunity_type" string="Opportunity Type" context="{'group_by': 'opportunity_type'}"/>
                    <filter name="group_opportunity_for" string="Opportunity For" context="{'group_by': 'opportunity_for'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="crm_prospect_opportunity_action" model="ir.actions.act_window">
        <field name="name">Opportunity</field>
        <field name="res_model">crm.prospect.opportunity</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a new Opportunity.
            </p>
        </field>
    </record>

    <menuitem
        id="crm_prospect_opportunity_menu"
        name="Opportunity"
        action="crm_prospect_opportunity_action"
        parent="fm_sale_crm.fm_sales_root_menu"
        sequence="3"/>

    <menuitem
            id="crm_prospect_opportunity_operation_menu"
            name="Opportunity"
            action="crm_prospect_opportunity_action"
            parent="freight_base.root_freight_operations"
            groups="fm_sale_crm.group_salesman,freight_base.group_manage_pricing,freight_base.group_operation_associate,base.group_erp_manager"
    />

</odoo>
