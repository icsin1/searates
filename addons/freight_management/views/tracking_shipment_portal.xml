<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="shipment_tracking_link_template" name="Portal Shipment Tracking Link Template">
        <div class="row">
            <div class="col">
                <h5 class="mb-0">
                    Shipment No:
                    <t t-if="master_shipment_id">
                        <t t-foreach="master_shipment_id" t-as="master_shipment">
                            <span class="text-primary font-weight-bold">
                                <t t-out="master_shipment.name" />
                            </span>
                        </t>
                    </t>
                    <t t-else="">
                        <t t-foreach="shipment_id" t-as="shipment">
                            <span class="text-primary font-weight-bold">
                                <t t-out="shipment.name" />
                            </span>
                        </t>
                    </t>
                </h5>
            </div>
        </div>
    </template>

    <template id="shipment_tracking_portal_template" name="Tracking Shipment Portal Template"
              inherit_id="portal.portal_sidebar" primary="True">
        <xpath expr="//div[hasclass('o_portal_sidebar')]" position="replace">
            <div class="container-fluid o_portal_sale_sidebar px-0">
                <div class="row py-4">
                    <div class="col text-center">
                        <h3 class="text-center"><strong>Track Shipment easily</strong></h3>
                        <img class="img-fluid" width="550" src="/freight_management/static/src/images/logistics.svg" alt="trackShipment"/>
                    </div>
                    <div class="col mt-auto">
                        <div class="card shadow mb-4 border-15">
                            <div class="card-body">
                                <form class="tracking mb4" action="/track/shipment" method="GET" id="tracking">
                                    <div class="form-row my-4">
                                        <div class="form-group col-md-6 mx-auto">
                                            <strong class="text-center"><strong>Enter Tracking Number</strong></strong>
                                            <input type="text" class="form-control" id="tracking_number"
                                                   name="tracking_number" t-att-value="tracking_number" autofocus="autofocus"/>
                                        </div>
                                    </div>
                                    <div class="form-row justify-content-center">
                                        <button class="btn btn-primary mr-3" type="submit">Track</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <t t-if="(shipment_id or master_shipment_id) and events">
                    <div class="card shadow mb-4 border-15">
                        <div class="card-header text-center">
                            Tracking Status
                        </div>
                        <div class="card-body">
                            <div class="row py-4">
                                <div class="col-md-6">
                                    <t t-if="events">
                                        <ul class="timeline">
                                            <t t-set="counter" t-value="0"/>
                                            <t t-foreach="events" t-as="event">
                                                <li>
                                                    <div t-att-class="'direction-r %s' % ('active' if event.id in active_event_ids else '')">
                                                        <div class="flag-wrapper">
                                                            <span class="flag"><t t-out="event.event_type_id.name" /></span>
                                                            <t t-if="event.actual_datetime">
                                                                <span class="time-wrapper time">
                                                                    <span t-out="event.fields_get(['actual_datetime'])['actual_datetime']['string']"/>:
                                                                    <span t-field="event.actual_datetime" t-options='{"widget": "datetime", "hide_seconds": True}'></span>
                                                                    (<t t-out="tz_str" /> )
                                                                </span>
                                                            </t>
                                                            <t t-elif="event.estimated_datetime">
                                                                <span class="time-wrapper time">
                                                                    <span t-out="event.fields_get(['estimated_datetime'])['estimated_datetime']['string']"/>:
                                                                    <span t-field="event.estimated_datetime" t-options='{"widget": "datetime", "hide_seconds": True}'></span>
                                                                    (<t t-out="tz_str" /> )
                                                                </span>
                                                            </t>
                                                        </div>
                                                        <div class="desc text-uppercase"><t t-out="event.location" /></div>
                                                    </div>
                                                </li>
                                            </t>
                                        </ul>
                                    </t>
                                </div>
                                <div class="col-md-6" id="tracking_details">
                                    <t t-call="freight_management.shipment_tracking_link_template"/>
                                    <div class="row my-4 py-2" id="shipping_details">
                                        <t t-foreach="master_shipment_id or shipment_id" t-as="shipment">
                                            <div class="col-md-6">
                                                <p class="large-screen-text-font-size" style="margin-bottom: 0px;">
                                                    <span><b>Shipment Type:</b></span>
                                                    <span class="large-screen-sub-text-font-size">
                                                        <t t-out="shipment.shipment_type_id.name" />
                                                    </span>
                                                </p>
                                            </div>
                                            <div class="col-md-6">
                                                <p class="large-screen-text-font-size" style="margin-bottom: 0px;">
                                                    <span><b>Transport Mode:</b></span>
                                                    <span class="large-screen-sub-text-font-size">
                                                        <t t-out="shipment.transport_mode_id.name" />
                                                    </span>
                                                </p>
                                            </div>
                                        </t>
                                    </div>
                                    <div class="row my-4 py-2" id="carriage_details">
                                        <t t-foreach="master_shipment_id or shipment_id" t-as="shipment">
                                            <div class="col-md-6">
                                                <p class="large-screen-text-font-size" style="margin-bottom: 0px;">
                                                    <t t-if="shipment.transport_mode_id.mode_type != 'land'">
                                                        <span><b>ETA:</b></span>
                                                        <span class="large-screen-sub-text-font-size"
                                                            t-field="shipment.eta_time" t-options='{"widget": "date"}'>
                                                        </span>
                                                    </t>
                                                    <t t-else="">
                                                        <span><b>ETP:</b></span>
                                                        <span class="large-screen-sub-text-font-size"
                                                            t-field="shipment.etp_time" t-options='{"widget": "date"}'>
                                                        </span>
                                                    </t>
                                                </p>
                                            </div>
                                            <div class="col-md-6">
                                                <p class="large-screen-text-font-size" style="margin-bottom: 0px;">
                                                    <span><b>ETD:</b></span>
                                                    <span class="large-screen-sub-text-font-size" t-field="shipment.etd_time" t-options='{"widget": "date"}'>
                                                    </span>
                                                </p>
                                            </div>
                                        </t>
                                    </div>
                                    <div class="row my-4 py-2" id="edt_adt_details">
                                        <t t-foreach="events" t-as="event">
                                                <div class="col-md-6">
                                                    <p class="mb-0">
                                                        <b>EDT :</b>
                                                        <span class="large-screen-sub-text-font-size">
                                                            <span t-field="event.estimated_datetime" t-options='{"widget": "date"}'/>
                                                        </span>
                                                    </p>
                                                </div>
                                                <div class="col-md-6">
                                                    <p class="mb-0">
                                                        <b>ADT :</b>
                                                        <span class="large-screen-sub-text-font-size">
                                                            <span t-field="event.actual_datetime" t-options='{"widget": "date"}'/>
                                                        </span>
                                                    </p>
                                                </div>
                                        </t>
                                    </div>
                                    <div class="row my-4 py-2" id="status_details">
                                        <t t-foreach="master_shipment_id or shipment_id" t-as="shipment">
                                            <div class="col-md-6">
                                                <p class="mb-0">
                                                    <b>Status:</b>
                                                    <span class="large-screen-sub-text-font-size">
                                                        <span t-field="shipment.state" />
                                                    </span>
                                                </p>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </t>
                <t t-elif="tracking_number and (not shipment_id or not events or not master_shipment_id)">
                    <div class="card shadow mb-4 border-15">
                        <div class="card-body">
                            <div class="text-center">
                                <h2>No tracking detail published yet!</h2>
                            </div>
                        </div>
                    </div>
                </t>
            </div>
        </xpath>
    </template>
</odoo>
