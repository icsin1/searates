<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="document_tax_totals" inherit_id="account.document_tax_totals">
        <xpath expr="//tr[hasclass('o_total')]" position="after">
            <t t-if="o.company_calculate_tds">
                <t t-call="l10n_in_tds.tds_groups_totals"/>
            </t>
        </xpath>
    </template>

    <template id="report_invoice_document" inherit_id="account.report_invoice_document">
        <xpath expr="//th[@name='th_taxes']" position="after">
            <t t-if="o.company_id.account_fiscal_country_id.code == 'IN' and o.company_calculate_tds">
                <th name="th_in_tds">TDS</th>
            </t>
        </xpath>
        <xpath expr="//t[@name='account_invoice_line_accountable']/td[hasclass('o_price_total')]" position="before">
            <td t-if="o.company_id.account_fiscal_country_id.code == 'IN' and o.company_calculate_tds">
              <span t-if="line.account_tds_rate_id" t-field="line.account_tds_rate_id"/>
            </td>
        </xpath>
    </template>

    <template id="tds_groups_totals">
        <t t-if="o.compute_tds">
            <t t-set="tds_totals" t-value="o.get_tds_groups_totals()"/>
            <t t-foreach="tds_totals" t-as="tds_val">
                <tr>
                    <td>
                        <span t-esc="tds_val.name"/>
                        <span class="text-nowrap"> on
                            <t t-esc="tds_val_value['invoice_line_amount']"
                                t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                        </span>
                    </td>
                    <td class="text-right">
                        <span class="text-nowrap" t-esc="tds_val_value['tds_amount']" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                    </td>
                </tr>
            </t>
            <tr>
                <td>
                    <span class="font-weight-bold"> Amount Due After TDS </span>
                </td>
                <td class="text-right">
                    <span t-field="o.amount_residual"/>
                </td>
            </tr>
        </t>
    </template>

</odoo>
