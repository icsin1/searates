<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="freight_service_job_view_form" model="ir.ui.view">
        <field name="name">freight.service.job.view.form</field>
        <field name="model">freight.service.job</field>
        <field name="arch" type="xml">
            <form string="Service Job" js_class="colered_control_panel">
                <header>
                    <field name="state" widget="statusbar"/>
                    <button string="Change Status" name="action_change_status" type="object" class="oe_highlight"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_service_job_documents" type="object" class="oe_stat_button" icon="fa-file" groups="freight_base.group_operation_associate,base.group_system,freight_base.group_manage_documents">
                            <field string="Documents" name="document_count" widget="statinfo"/>
                        </button>
                    </div>
                    <div class="row">
                        <div class="col pr-0">
                            <label for="booking_nomination_no" />
                            <div class="oe_title">
                                <h1>
                                    <field name="booking_nomination_no" placeholder="Booking Ref" force_save="1"/>
                                </h1>
                            </div>
                        </div>
                        <div class="col pl-0">
                            <label for="service_job_number" />
                            <div class="oe_title">
                                <h1>
                                    <field name="service_job_number" placeholder="Service Job Number"/>
                                </h1>
                            </div>
                        </div>
                    </div>
                    <group>
                        <group>
                            <field name="id" invisible="1"/>
                            <field name="date" />
                            <field name="currency_id" groups="base.group_no_one"/>
                            <field name="service_job_type_id" required="1" options="{'no_open': True}"/>
                        </group>
                        <group>
                            <field name="company_id" options="{'no_create': True, 'no_open': True}" groups="base.group_multi_company"/>
                            <field name="sales_agent_id" options="{'no_create': True, 'no_open': True}"/>
                            <field name="tag_ids" widget="many2many_tags"/>
                        </group>
                    </group>
                    <separator string="Declared Weight &amp; Volume"/>
                    <group>
                        <group>
                            <label for="pack_unit" string="Packs"/>
                            <div class="o_row">
                                <field name="pack_unit" />
                                <field name="pack_unit_uom_id" options="{'no_open': True, 'no_create': True}" />
                            </div>
                            <label for="gross_weight_unit"/>
                            <div class="o_row">
                                <field name="gross_weight_unit"/>
                                <field name="gross_weight_unit_uom_id" options="{'no_open': True, 'no_create': True}"/>
                            </div>
                            <label for="weight_volume_unit"/>
                            <div class="o_row">
                                <field name="weight_volume_unit"/>
                                <field name="weight_volume_unit_uom_id" options="{'no_open': True, 'no_create': True}"/>
                            </div>
                        </group>
                        <group>
                            <label for="net_weight_unit"/>
                            <div class="o_row">
                                <field name="net_weight_unit" />
                                <field name="net_weight_unit_uom_id" class="ml-1" options="{'no_open': True, 'no_create': True}" />
                            </div>
                            <label for="volume_unit"/>
                            <div class="o_row">
                                <field name="volume_unit"/>
                                <field name="volume_unit_uom_id" class="ml-1" options="{'no_open': True, 'no_create': True}"/>
                            </div>
                            <label for="chargeable_kg"/>
                            <div class="d-flex oe_inline">
                                <field name="chargeable_kg" force_save="1" readonly="1"/>
                                <field name="chargeable_uom_id" class="ml-2" options="{'no_open': True, 'no_create': True}" readonly="1" force_save="1"/>
                            </div>
                        </group>
                    </group>
                    <group col="6">
                        <group string="Customer" col="2" colspan="2">
                            <field name="client_id" context="{'force_change': True}"/>
                            <field name="client_address_id" string="Address"
                                context="{'partner_category_display': 'short', 'show_address': 1, 'default_parent_id': client_id, 'default_type': 'invoice', 'form_view_ref': 'freight_base.res_partner_address_form'}"
                                options="{&quot;always_reload&quot;: True, &quot;highlight_first_line&quot;: True}"/>
                        </group>
                        <group string="Shipper" col="2" colspan="2">
                            <field name="shipper_id" context="{'force_change': True}"/>
                            <field name="shipper_address_id" string="Address"
                                context="{'partner_category_display': 'short', 'show_address': 1, 'default_parent_id': shipper_id, 'default_type': 'delivery', 'form_view_ref': 'freight_base.res_partner_address_form'}"
                                options="{&quot;always_reload&quot;: True, &quot;highlight_first_line&quot;: True}"/>
                        </group>
                        <group string="Consignee" col="2" colspan="2">
                            <field name="consignee_id" context="{'force_change': True}"/>
                            <field name="consignee_address_id" string="Address"
                                context="{'partner_category_display': 'short', 'show_address': 1, 'default_parent_id': consignee_id, 'default_type': 'delivery', 'form_view_ref': 'freight_base.res_partner_address_form'}"
                                options="{&quot;always_reload&quot;: True, &quot;highlight_first_line&quot;: True}"/>
                        </group>
                    </group>

                    <notebook>
                        <page name="carrier_details" string="Carriage">
                            <group>
                                <group string="Origin">
                                    <field name="origin_un_location_id" string="Origin"/>
                                    <field name="origin_country_id" invisible="1"/>
                                    <field name="origin_port_un_location_id" context="{'default_country_id': origin_country_id}"  attrs="{'required' :[('state','not in',['created','cancelled'])]}"/>
                                    <field name="etd_time"/>
                                    <field name="atd_time" />
                                    <field name="pickup_address"/>
                                </group>
                                <group string="Destination">
                                    <field name="destination_un_location_id" string="Destination"/>
                                    <field name="destination_country_id" invisible="1"/>
                                    <field name="destination_port_un_location_id" context="{'default_country_id': destination_country_id}"
                                        attrs="{'required' :[('state','not in',['created','cancelled'])]}"/>
                                    <field name="eta_time"/>
                                    <field name="ata_time" />
                                    <field name="delivery_address"/>
                                </group>
                            </group>
                        </page>
                        <page name="additional_details" string="Additional">
                            <group string="HAZ Details">
                                <group>
                                    <field name="is_hazardous" widget="boolean_toggle"/>
                                </group>
                                <group>
                                </group>
                                <group attrs="{'invisible': [('is_hazardous', '=', False)]}">
                                    <field name="haz_class_id" options="{'no_create': True, 'no_open': True}" attrs="{'required': [('is_hazardous', '=', True)]}"/>
                                    <field name="haz_un_number" attrs="{'required': [('is_hazardous', '=', True)]}"/>
                                </group>
                                <group attrs="{'invisible': [('is_hazardous', '=', False)]}">
                                    <field name="haz_remark"/>
                                </group>
                            </group>
                        </page>
                        <page name="customs" string="Customs">
                            <group>
                                <field name="has_customs" widget="boolean_toggle"/>
                            </group>
                            <group attrs="{'invisible': [('has_customs', '=', False)]}">
                                <group>
                                    <field name="customs_ad_code" attrs="{'required': [('has_customs', '=', True)]}"/>
                                    <field name="customs_location_id" attrs="{'required': [('has_customs', '=', True)]}"/>
                                    <field name="customs_declaration_number"/>
                                    <field name="tariff_determination_number"/>
                                    <field name="customs_procedure_code"/>
                                </group>
                                <group>
                                    <field name="customs_be_type_id" options="{'no_create': 1, 'no_open':1}" attrs="{'required': [('has_customs', '=', True)]}"/>
                                    <field name="customs_declaration_date"/>
                                    <field name="customs_clearance_datetime"/>
                                    <field name="value_determination_number"/>
                                </group>
                            </group>
                            <group attrs="{'invisible': [('has_customs', '=', False)]}">
                                <group string="BOE Details">
                                    <field name="boe_number" />
                                    <field name="boe_date" />
                                    <field name="ownership" widget="radio" options="{'horizontal': True}"/>
                                    <field name="ownership_id" attrs="{'required': ['|', ('boe_number', '!=', False), ('boe_date', '!=', False)]}"/>
                                </group>
                            </group>
                            <separator string="Documents" attrs="{'invisible': [('has_customs', '=', False)]}"/>
                            <field name="customs_document_ids" attrs="{'invisible': [('has_customs', '=', False)]}">
                                <tree editable="bottom">
                                    <field name="declaration_number" string="Declaration Number"/>
                                    <field name="declaration_date"/>
                                    <field name="note"/>
                                    <field name="file_name" invisible="True"/>
                                    <field name="document_file" filename="file_name" widget="binary"/>
                                    <field name="customs_clearance_datetime" />
                                </tree>
                            </field>
                        </page>

                        <page name="parties" string="Parties">
                            <field name="service_job_partner_ids" nolabel="1">
                                <tree editable="bottom">
                                    <field name="partner_type_id" options="{'no_create': True, 'no_open': True}"/>
                                    <field name="partner_id" domain="[('category_ids', 'in', partner_type_id)]" context="{'force_change': True, 'default_partner_type_id': partner_type_id, 'default_category_ids': [(4, partner_type_id)]}"  />
                                    <field name="party_address_id" context="{'default_parent_id': partner_id, 'default_partner_type_id': partner_type_id, 'default_category_ids': [(4, partner_type_id)]}"/>
                                </tree>
                            </field>
                        </page>
                        <page name="milestones" string="Milestones Tracking">
                            <field name="event_ids" />
                        </page>
                        <page string="T &amp; C" name="terms_and_conditions">
                            <field name="terms_ids" context="{'default_service_job_id': active_id}"/>
                        </page>
                        <page string="Remarks" name="shipment_remarks">
                            <field name="remarks" attrs="{'readonly': [('state', 'in', ['cancelled','completed'])]}"/>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record id="freight_service_job_info_view_form" model="ir.ui.view">
        <field name="name">freight.service.job.info.view.form</field>
        <field name="model">freight.service.job</field>
        <field name="priority">100</field>
        <field name="arch" type="xml">
            <form string="Service Job">
                <sheet>
                    <field name="state" invisible="1"/>
                    <div class="oe_button_box" name="button_box">
                        <button class="oe_stat_button" special="cancel" icon="fa-clock-o">
                            <div class="o_form_field o_stat_info">
                                <span class="o_stat_text">Service Job Date</span>
                                <span class="o_stat_value">
                                    <field name="date"/>
                                </span>
                            </div>
                        </button>
                    </div>
                    <group string="Declared Weight &amp; Volume">
                        <label for="pack_unit" string="Packs"/>
                        <div class="d-flex oe_inline">
                            <field name="pack_unit" force_save="1"/>&amp;nbsp;
                            <field name="pack_unit_uom_id" options="{'no_open': True, 'no_create': True}" force_save="1"/>
                        </div>
                        <label for="gross_weight_unit"/>
                        <div class="d-flex oe_inline">
                            <field name="gross_weight_unit" force_save="1"/>&amp;nbsp;
                            <field name="gross_weight_unit_uom_id" options="{'no_open': True, 'no_create': True}" force_save="1"/>
                        </div>
                        <label for="weight_volume_unit"/>
                        <div class="o_row">
                            <field name="weight_volume_unit"/>
                            <field name="weight_volume_unit_uom_id" options="{'no_open': True, 'no_create': True}" force_save="1"/>
                        </div>
                        <label for="net_weight_unit"/>
                        <div class="d-flex oe_inline">
                            <field name="net_weight_unit" force_save="1"/>&amp;nbsp;
                            <field name="net_weight_unit_uom_id" options="{'no_open': True, 'no_create': True}" force_save="1"/>
                        </div>
                        <label for="volume_unit"/>
                        <div class="d-flex oe_inline">
                            <field name="volume_unit" force_save="1"/>&amp;nbsp;
                            <field name="volume_unit_uom_id" options="{'no_open': True, 'no_create': True}" force_save="1"/>
                        </div>
                        <label for="chargeable_kg"/>
                        <div class="d-flex oe_inline">
                            <field name="chargeable_kg" force_save="1" readonly="1"/>
                            <field name="chargeable_uom_id" class="ml-2" options="{'no_open': True, 'no_create': True}" readonly="1" force_save="1"/>
                        </div>
                    </group>
                    <group string="Parties Details">
                        <field name="client_id"></field>
                        <field name="shipper_id"></field>
                        <field name="consignee_id"></field>
                        <field name="company_id" invisible="1" />
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="freight_service_job_view_kanban" model="ir.ui.view">
        <field name="name">freight.service.job.view.kanban</field>
        <field name="model">freight.service.job</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" records_draggable="0" default_group_by="state" quick_create="false" >
                <field name="name"/>
                <field name="origin_un_location_id"/>
                <field name="destination_un_location_id"/>
                <field name="company_id"/>
                <field name="client_id"/>
                <field name="shipper_id"/>
                <field name="consignee_id"/>
                <field name="currency_id"/>
                <field name="tag_ids"/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                            <div class="row mb4">
                                <div id="title" class="col d-flex justify-content-between">
                                    <h3 class="mb-0 pb-0 text-info"><t t-esc="record.name.value"/></h3>
                                    <h6>
                                        <field name="company_id"/>
                                    </h6>
                                </div>
                            </div>
                            <div class="row mb4">
                                <div class="col-12">
                                    <t t-if="record.service_job_number.raw_value"><strong>Service Job No:</strong> <field name="service_job_number" class="font-weight-bold"/></t>
                                    <field name="tag_ids" widget="many2many_tags"/>
                                </div>
                            </div>
                            <t t-if="record.origin_un_location_id.value and record.destination_un_location_id.value">
                                <h4>
                                    <field name="origin_un_location_id"/> <span class="fa fa-arrow-right" aria-label="circle"/> <field name="destination_un_location_id"/>
                                </h4>
                            </t>
                            <table class="table table-sm small mb-0" name="customer_details">
                                <tr class="table-primary">
                                    <th>Customer</th>
                                    <th>Shipper</th>
                                    <th>Consignee</th>
                                </tr>
                                <tr>
                                    <td><field name="client_id"/></td>
                                    <td><field name="shipper_id"/></td>
                                    <td><field name="consignee_id"/></td>
                                </tr>
                            </table>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="freight_service_job_view_search" model="ir.ui.view">
        <field name="name">freight.service.job.view.search</field>
        <field name="model">freight.service.job</field>
        <field name="arch" type="xml">
            <search string="Service Job">
                <field name="name" string="Search Service Job" filter_domain="['|', '|', ('booking_nomination_no', 'ilike', self), ('service_job_number', 'ilike', self), ('tag_ids.name', 'ilike', self)]"/>
                <field name="service_job_number" optional="hide"/>
                <field name="booking_nomination_no" string="Booking Ref / Nomination No" />
                <field name="tag_ids"/>
                <field name="client_id" />
                <field name="shipper_id" />
                <field name="consignee_id" />
                <field name="origin_un_location_id"/>
                <field name="destination_un_location_id"/>
                <separator/>
                <filter name="current_month" string="Current Month" domain="[
                    ('date', '&gt;=', (context_today()).strftime('%Y-%m-01')),
                    ('date', '&lt;', (context_today() + relativedelta(months=1)).strftime('%Y-%m-01'))]"/>
                <filter name="date" string="Service Job Date" date="date"/>
                <filter name="create_date" string="Create Date" date="create_date"/>
                <filter name="ata_time" string="ATA" date="ata_time"/>
                <filter name="atd_time" string="ATD" date="atd_time"/>
                <filter name="eta_time" string="ETA" date="eta_time"/>
                <filter name="etd_time" string="ETD" date="etd_time"/>
                <filter name="group_by_state" string="State" context="{'group_by': 'state'}" />
                <separator/>
                <filter name="group_by_date" string="Service Job Date" context="{'group_by': 'date'}"/>
                <filter name="group_by_create_date" string="Create Date" context="{'group_by': 'create_date'}"/>
                <filter name="group_by_ata_time" string="ATA" context="{'group_by': 'ata_time'}"/>
                <filter name="group_by_atd_time" string="ATD" context="{'group_by': 'atd_time'}"/>
                <filter name="group_by_eta_time" string="ETA" context="{'group_by': 'eta_time'}"/>
                <filter name="group_by_etd_time" string="ETD" context="{'group_by': 'etd_time'}"/>
            </search>
        </field>
    </record>

    <record id="freight_service_job_view_tree" model="ir.ui.view">
        <field name="name">freight.service.job.view.tree</field>
        <field name="model">freight.service.job</field>
        <field name="arch" type="xml">
            <tree string="Service Job">
                <field name="booking_nomination_no"/>
                <field name="service_job_number" />
                <field name="currency_id" optional="hide"/>
                <field name="date"/>
                <field name="state" string="State"/>
                <field name="sales_agent_id" optional="hide"/>
                <field name="tag_ids" widget="many2many_tags" optional="hide"/>
                <field name="pack_unit" optional="hide"/>
                <field name="pack_unit_uom_id" optional="hide"/>
                <field name="gross_weight_unit" optional="hide"/>
                <field name="gross_weight_unit_uom_id" optional="hide"/>
                <field name="weight_volume_unit" optional="hide"/>
                <field name="weight_volume_unit_uom_id" optional="hide"/>
                <field name="net_weight_unit" optional="hide"/>
                <field name="net_weight_unit_uom_id" optional="hide"/>
                <field name="volume_unit" optional="hide"/>
                <field name="volume_unit_uom_id" optional="hide"/>
                <field name="chargeable_kg" optional="hide"/>
                <field name="chargeable_uom_id" optional="hide"/>
                <field name="client_id" optional="hide"/>
                <field name="shipper_id" optional="hide"/>
                <field name="consignee_id" optional="hide"/>
                <field name="origin_un_location_id" optional="hide"/>
                <field name="origin_port_un_location_id" optional="hide"/>
                <field name="destination_un_location_id" optional="hide"/>
                <field name="destination_port_un_location_id" optional="hide"/>
                <field name="etd_time" optional="hide"/>
                <field name="eta_time" optional="hide"/>
                <field name="atd_time" optional="hide"/>
                <field name="ata_time" optional="hide"/>
                <field name="boe_number" optional="hide"/>
                <field name="boe_date" optional="hide"/>
                <field name="ownership" optional="hide"/>
                <field name="ownership_id" optional="hide"/>
            </tree>
        </field>
    </record>

    <record id="view_freight_service_job_calendar" model="ir.ui.view">
        <field name="name">freight.service.job.calendar</field>
        <field name="model">freight.service.job</field>
        <field name="arch" type="xml">
            <calendar string="Freight Service Job" date_start="date" date_stop="date" event_open_popup="true" mode="month" color="booking_nomination_no" quick_add="False">
                <field name="date"/>
                <field name="booking_nomination_no"/>
            </calendar>
        </field>
    </record>

    <record id="freight_service_job_action" model="ir.actions.act_window">
        <field name="name">Service Job</field>
        <field name="res_model">freight.service.job</field>
        <field name="view_mode">kanban,calendar,tree,form</field>
        <field name="domain">[]</field>
        <field name="context">{'control_panel_class': 'service_job'}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No records available
            </p>
        </field>
    </record>

    <menuitem
        id="freight_service_job_menu"
        name="Service Job"
        action="freight_service_job_action"
        parent="freight_base.root_freight_operations"
        groups="fm_sale_crm.group_sales_manager,freight_base.group_operation_associate,freight_base.group_manage_documents,base.group_erp_manager"
        sequence="2"/>
</odoo>
