<odoo>
    <data>
        <record model="ir.actions.server" id="account.action_move_switch_invoice_to_credit_note">
            <field name="name">Switch into Refund/Credit Note(Remove)</field>
            <field name="binding_model_id" eval="False"/>
        </record>

        <record id="account_move_lines_ics_in_view_tree" model="ir.ui.view">
            <field name="name">account.move.view.tree</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_in_invoice_bill_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='name']" position="attributes">
                    <attribute name="optional">hide</attribute>
                </xpath>
            </field>
        </record>

        <record id="account_view_invoice_bill_tree" model="ir.ui.view">
            <field name="name">account.move.view.invoice.bill.tree.inherit</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_invoice_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='currency_id']" position="attributes">
                    <attribute name="optional"></attribute>
                </xpath>
                <xpath expr="//field[@name='company_id']" position="after">
                    <field name="company_currency_id"/>
                </xpath>
                <xpath expr="//field[@name='currency_id']" position="after">
                    <xpath expr="//field[@name='amount_total_in_currency_signed']" position="move"/>
                </xpath>
                <xpath expr="//header/button[@name='action_register_payment']" position="attributes">
                    <attribute name="context">{'click_from_treeview':True}</attribute>
                </xpath>
            </field>
        </record>

        <record id="account_move_lines_ics_out_view_tree" model="ir.ui.view">
            <field name="name">account.move.view.tree</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_out_invoice_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='name']" position="attributes">
                    <attribute name="optional">hide</attribute>
                </xpath>
            </field>
        </record>

        <record id="account_move_inherited_form_ics_account" model="ir.ui.view">
            <field name="name">account.move.inherited.form</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">
                <xpath expr="//header/button[last()]" position="after">
                    <button type="object" name="action_print_payment_receipt"
                        string="Print Payment Receipt" attrs="{'invisible': [('payment_state', 'not in', ('partial', 'in_payment', 'paid'))]}"/>
                </xpath>
                <xpath expr="//div[hasclass('oe_title')]//h1[1]" position="attributes">
                    <attribute name="attrs">{'invisible': ['|', ('state', '!=', 'draft'), ('allow_reference_number', '=', True)]}</attribute>
                </xpath>
                <xpath expr="//div[hasclass('oe_title')]//h1[2]" position="attributes">
                    <attribute name="attrs">{'invisible': [('state', '=', 'draft'), ('allow_reference_number', '=', False)]}</attribute>
                </xpath>
                <xpath expr="//div[hasclass('oe_title')]//field[@name='name']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//span[hasclass('o_form_label')]//field[@name='move_type']/.." position="replace">
                    <span class="o_form_label" attrs="{'invisible': [('move_type', '=', 'in_refund')]}"><field name="move_type" attrs="{'invisible': [('move_type', '=', 'entry')]}" readonly="1" nolabel="1"/></span>
                    <span class="o_form_label" attrs="{'invisible': [('move_type', '!=', 'in_refund')]}"><label for="name" string="Vendor Credit Note" attrs="{'invisible': [('move_type', '=', 'entry')]}"/></span>
                </xpath>
                <xpath expr="//div[hasclass('oe_title')]//field[@name='name']" position="after">
                    <field name="allow_reference_number" invisible="1"/>
                    <field name="name" attrs="{'readonly': ['|', ('allow_reference_number', '=', False), '&amp;', ('state', '!=', 'draft'), ('allow_reference_number', '=', True)]}"/>
                </xpath>
                <xpath expr="//page[last()]" position="after">
                    <page string="Terms &amp; Conditions" name="terms_conditions">
                        <group>
                            <field name="invoice_terms_template_id" />
                            <field name="notes"/>
                        </group>
                    </page>
                </xpath>
                <xpath expr="//button[@name='action_reverse']" position="attributes">
                    <attribute name="attrs">{'invisible': ['|', ('move_type', '!=', 'out_invoice'), ('state', '!=', 'posted')]}</attribute>
                </xpath>
                <xpath expr="//button[@name='action_reverse']" position="after">
                    <button name="action_debit_reverse" string="Add Credit Note" type="object" groups="account.group_account_invoice" attrs="{'invisible': ['|', ('move_type', '!=', 'in_invoice'), ('state', '!=', 'posted')]}"/>
                </xpath>
                <xpath expr="//field[@name='invoice_line_ids']" position="attributes">
                    <attribute name="class" separator=" " add="sticky_header_one2many"/>
                </xpath>
                <xpath expr="//div[@name='journal_div']" position="after">
                    <field name="label" attrs="{'invisible': [('move_type', '=', 'entry')]}"/>
                </xpath>
            </field>
        </record>

        <!--Change Credit/Debit Label for the Move reversal wizard-->
        <record id="view_account_move_reversal" model="ir.ui.view">
            <field name="name">account.move.reversal.search.inherited</field>
            <field name="model">account.move.reversal</field>
            <field name="inherit_id" ref="account.view_account_move_reversal"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='refund_method']/../.." position="replace">
                    <group>
                        <group>
                            <div class="o_td_label" attrs="{'invisible': ['|',('move_type', 'not in', ('out_invoice', 'in_invoice')),('residual', '=', 0)]}">
                                <label for="refund_method" string="Credit Method" attrs="{'invisible': ['|',('move_type', 'not in', ('out_invoice')),('residual', '=', 0)]}"/>
                                <label for="refund_method" string="Debit Method" attrs="{'invisible': ['|',('move_type', 'not in', ('in_invoice')),('residual', '=', 0)]}"/>
                            </div>
                            <div class="o_row" attrs="{'invisible': ['|',('move_type', 'not in', ('out_invoice', 'in_invoice')),('residual', '=', 0)]}">
                                <field name="refund_method" widget="radio" attrs="{'readonly': [('residual', '=', 0)]}" nolabel="1"/>
                            </div>
                        </group>
                        <group attrs="{'invisible': ['|', ('move_type', 'not in', ('out_invoice', 'in_invoice', 'some_invoice')), ('residual', '=', 0)]}">
                            <div attrs="{'invisible':[('refund_method', '!=', 'refund')]}" class="oe_grey" colspan="4">
                                The <span attrs="{'invisible': [('move_type', '!=', 'in_invoice')]}">debit</span><span attrs="{'invisible': [('move_type', '=', 'in_invoice')]}">credit</span> note is created in draft and can be edited before being issued.
                            </div>
                            <div attrs="{'invisible':[('refund_method', '!=', 'cancel')]}" class="oe_grey" colspan="4">
                               The <span attrs="{'invisible': [('move_type', '!=', 'in_invoice')]}">debit</span><span attrs="{'invisible': [('move_type', '=', 'in_invoice')]}">credit</span> note is auto-validated and reconciled with the invoice.
                            </div>
                            <div attrs="{'invisible':[('refund_method', '!=', 'modify')]}" class="oe_grey" colspan="4">
                               The <span attrs="{'invisible': [('move_type', '!=', 'in_invoice')]}">debit</span><span attrs="{'invisible': [('move_type', '=', 'in_invoice')]}">credit</span> note is auto-validated and reconciled with the invoice.
                               The original invoice is duplicated as a new draft.
                            </div>
                        </group>
                    </group>
                </xpath>
            </field>
        </record>
    </data>
</odoo>
