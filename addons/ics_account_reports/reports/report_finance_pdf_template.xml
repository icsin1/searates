<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <template id="section_childlines">
        <t t-foreach="line['children']" t-as="detail_line">
            <t t-set="space_td" t-value="'margin-left: '+ str(detail_line['level'] * 20) + 'px;'"/>
            <tr>
                <td>
                    <div t-att-style="space_td">
                        <t t-out="detail_line['title']"/>
                    </div>
                </td>
                <td t-foreach="detail_line['values']" t-as="line_key" class="text-right">
                    <t t-if="isinstance(detail_line['values'][line_key], tuple)">
                        <t t-out="tuple(detail_line['values'][line_key])[1]"/>
                    </t>
                    <t t-else="">
                        <t t-out="detail_line['values'][line_key]"/>
                    </t>
                </td>
            </tr>
            <t t-if="detail_line['children']">
                <t t-set="line" t-value="detail_line"/>
                <t t-call="ics_account_reports.section_childlines"/>
            </t>
            <t t-else="">
                <t t-if="detail_line['group_by'] and not options.get('folded')">
                    <t t-foreach="report.get_account_report_section_data(detail_line,options)" t-as="lines">
                    <t t-set="space_td" t-value="'margin-left: '+ str(lines['level'] * 20) + 'px;'"/>
                    <tr>
                        <td>
                            <div t-att-style="space_td">
                                <t t-out="lines['title']"/>
                            </div>
                        </td>
                        <td t-foreach="lines['values']" t-as="line_key" class="text-right">
                            <t t-if="isinstance(lines['values'][line_key], tuple)">
                                <t t-out="tuple(lines['values'][line_key])[1]"/>
                            </t>
                            <t t-else="">
                                <t t-out="lines['values'][line_key]"/>
                            </t>
                        </td>
                    </tr>
                </t>
                </t>
            </t>
        </t>
    </template>

    <template id="report_finance_pdf_template">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <div class="page">
                    <t t-set="report" t-value="docs.env[report_model].browse(int(report_id))"/>
                    <div class="bg-200 p-2">
                        <h2 class="text-center"><t t-out="report.get_title()"/>  (<span t-out="report.convert_date_to_lang_date(options['date']['date_from'])"/> to <span t-out="report.convert_date_to_lang_date(options['date']['date_to'])"/>)</h2>
                        <h5 t-out="options['date']['string']"/>
                        <t t-if="report._name == 'account.partner.ledger'">
                            <strong class="h6 py-2">From Company: <span t-out="options['company']"/></strong><br/>
                        </t>
                        <t t-else="">
                            <strong class="h6 py-2">Company: <span t-out="options['company']"/></strong><br/>
                        </t>
                        <t t-if="options['date']['date_from']">
                            <strong class="h6 py-2">Period: <span t-out="report.convert_date_to_lang_date(options['date']['date_from'])"/> to <span t-out="report.convert_date_to_lang_date(options['date']['date_to'])"/></strong><br/>
                        </t>
                        <t t-else="">
                            <strong class="h6 py-2">Period: <span t-out="options['date']['string']"/></strong><br/>
                        </t>
                    </div>
                    <table style="table-layout:fixed;" width="100%" class="table table-bg-white table-sm table-bordered">
                        <t t-set="header_items" t-value="options.get('headers')"/>
                        <thead>
                            <tr class="text-right bg-300">
                                <th></th>
                                <t t-foreach="header_items" t-as="title">
                                    <th class="text-right">
                                        <span t-out="title"/>
                                    </th>
                                </t>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-if="report._name == 'account.finance.report'">
                                <t t-set="section_lines" t-value="report._get_sections(report.section_ids, options, {})"/>
                            </t>
                            <t t-if="report._name != 'account.finance.report'">
                                <t t-set="section_lines" t-value="report._get_sections(options)"/>
                            </t>
                            <t t-foreach="section_lines" t-as="line">
                                <tr t-attf-class="border_level_{{line['level']}}">
                                    <td>
                                        <strong t-out="line['title']"/>
                                    </td>
                                    <td t-foreach="line['values']" t-as="line_key" class="text-right"  style="white-space: nowrap;">
                                        <t t-if="isinstance(line['values'][line_key], tuple)">
                                            <strong t-out="tuple(line['values'][line_key])[1]"/>
                                        </t>
                                        <t t-else="">
                                            <strong t-out="line['values'][line_key]"/>
                                        </t>
                                    </td>
								</tr>
                                <t t-if="report._name == 'account.finance.report' and line['children']">
                                    <t t-if="line['children']">
                                        <t t-call="ics_account_reports.section_childlines"/>
                                    </t>
                                </t>
                                <t t-if="report._name != 'account.finance.report' and line['id'] != 'total' and not options.get('folded')">
                                    <t t-set="space_td" t-value="'margin-left: '+ str(line['level'] * 20) + 'px;'"/>
                                    <t t-set="total_balance" t-value="0.0"/>
                                    <tr t-foreach="report.get_account_report_section_data(line, options)" t-as="detail_line">
                                        <td>
                                            <div t-att-style="space_td">
                                                <t t-out="detail_line['title']"/>
                                            </div>
                                        </td>
                                        <t t-if="total_balance == 0.0">
											<t t-if="'balance' in detail_line">
												<t t-set="total_balance" t-value="detail_line['balance']"/>
											</t>
										</t>
                                        <td t-foreach="detail_line['values']" t-as="line_key" class="text-right">
                                            <t t-if="isinstance(detail_line['values'][line_key], tuple)">
												<t t-if="line_key == 'Balance'">
													<t t-out="detail_line['values'][line_key][0]" t-options="{'widget': 'monetary', 'display_currency': env.company.currency_id}"/>
												</t>
												<t t-else="">
													<t t-out="tuple(detail_line['values'][line_key])[1]"/>
												</t>
                                            </t>
                                            <t t-else="">
                                                <t t-out="detail_line['values'][line_key]"/>
                                            </t>
                                        </td>
                                    </tr>
                                </t>
							</t>
                        </tbody>
                    </table>
                </div>
                <p style="page-break-inside:avoid;"> </p>
            </t>
        </t>
    </template>

</odoo>