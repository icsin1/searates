<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- Report Settings -->
        <record id="finance_report_profit_and_loss" model="account.finance.report">
            <field name="name">Profit &amp; Loss</field>
        </record>
        <!-- Sections -->

        <!-- Income -->
        <record id="finance_report_pnl_section_income" model="account.finance.report.section">
            <field name="name">Income</field>
            <field name="code">INC</field>
            <field name="report_id" ref="finance_report_profit_and_loss"/>
            <field name="computation_formula">OPINC + OIN</field>
            <field name="sequence">1</field>
            <field name="level">0</field>
            <field name="validation_domain">[('account_id.user_type_id.internal_group', '=', 'income')]</field>
        </record>

        <!-- Income > Gross Profit -->
        <record id="finance_report_pnl_section_income_gross_profit" model="account.finance.report.section">
            <field name="name">Gross Profit</field>
            <field name="code">GRP</field>
            <field name="computation_formula">OPINC - COR</field>
            <field name="parent_id" ref="finance_report_pnl_section_income"/>
            <field name="level">1</field>
            <field name="sequence">1</field>
        </record>

        <!-- Income > Gross Profit > Operating Income -->
        <record id="finance_report_pnl_section_income_gross_profit_operating_income" model="account.finance.report.section">
            <field name="name">Operating Income</field>
            <field name="code">OPINC</field>
            <field name="computation_formula">-sum</field>
            <field name="parent_id" ref="finance_report_pnl_section_income_gross_profit"/>
            <field name="data_domain" eval="[('account_id.user_type_id', '=', ref('account.data_account_type_revenue'))]"/>
            <field name="group_by">account_id</field>
            <field name="sequence">1</field>
            <field name="level">2</field>
        </record>

        <!-- Income > Gross Profit > Cost of Revenue -->
        <record id="finance_report_pnl_section_income_gross_profit_cost_of_revenue" model="account.finance.report.section">
            <field name="name">Cost of Revenue</field>
            <field name="code">COR</field>
            <field name="computation_formula">sum</field>
            <field name="parent_id" ref="finance_report_pnl_section_income_gross_profit"/>
            <field name="data_domain" eval="[('account_id.user_type_id', '=', ref('account.data_account_type_direct_costs'))]"/>
            <field name="group_by">account_id</field>
            <field name="sequence">2</field>
            <field name="level">2</field>
        </record>

        <!-- Income > Other Income -->
        <record id="finance_report_pnl_section_income_other_income" model="account.finance.report.section">
            <field name="name">Other Income</field>
            <field name="code">OIN</field>
            <field name="parent_id" ref="finance_report_pnl_section_income"/>
            <field name="data_domain" eval="[('account_id.user_type_id', '=', ref('account.data_account_type_other_income'))]"/>
            <field name="group_by">account_id</field>
            <field name="level">1</field>
            <field name="sequence">2</field>
        </record>

        <!-- Expenses -->
        <record id="finance_report_pnl_section_expenses" model="account.finance.report.section">
            <field name="name">Expenses</field>
            <field name="code">EXG</field>
            <field name="report_id" ref="finance_report_profit_and_loss"/>
            <field name="computation_formula">EXP + DEP</field>
            <field name="sequence">2</field>
            <field name="level">0</field>
            <field name="validation_domain" eval="[('account_id.user_type_id.internal_group', '=', 'expense'), '!', ('account_id.user_type_id', '=', ref('account.data_account_type_direct_costs'))]"/>
        </record>

        <!-- Expenses > Expenses -->
        <record id="finance_report_pnl_section_expense_expenses" model="account.finance.report.section">
            <field name="name">Expenses</field>
            <field name="code">EXP</field>
            <field name="computation_formula">sum</field>
            <field name="parent_id" ref="finance_report_pnl_section_expenses"/>
            <field name="data_domain" eval="[('account_id.user_type_id', '=', ref('account.data_account_type_expenses'))]"/>
            <field name="group_by">account_id</field>
            <field name="level">2</field>
            <field name="sequence">1</field>
        </record>
        <!-- Expenses > Depreciation -->
        <record id="finance_report_pnl_section_expense_depreciation" model="account.finance.report.section">
            <field name="name">Depreciation</field>
            <field name="code">DEP</field>
            <field name="computation_formula">sum</field>
            <field name="parent_id" ref="finance_report_pnl_section_expenses"/>
            <field name="data_domain" eval="[('account_id.user_type_id', '=', ref('account.data_account_type_depreciation'))]"/>
            <field name="group_by">account_id</field>
            <field name="level">2</field>
            <field name="sequence">2</field>
        </record>

        <!-- Net Profit -->
        <record id="finance_report_pnl_section_net_profit" model="account.finance.report.section">
            <field name="name">Net Profit</field>
            <field name="code">NEP</field>
            <field name="computation_formula">OPINC + OIN - COR - EXP - DEP</field>
            <field name="report_id" ref="finance_report_profit_and_loss"/>
            <field name="sequence">3</field>
            <field name="level">0</field>
        </record>

        <!-- Client Action -->
        <record id="action_account_reports__profit_and_loss" model="ir.actions.client">
            <field name="name">Profit &amp; Loss</field>
            <field name="tag">ics_account_reports.finance_reports</field>
            <field name="context" eval="{'model': 'account.finance.report', 'id': ref('ics_account_reports.finance_report_profit_and_loss')}"/>
            <field name="res_model">account.move.line</field>
        </record>

    </data>

</odoo>
