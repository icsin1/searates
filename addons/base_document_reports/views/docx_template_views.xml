<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="docx_template_view_form" model="ir.ui.view">
        <field name="name">docx.template.view.form</field>
        <field name="model">docx.template</field>
        <field name="arch" type="xml">
            <form string="Field Template">
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="download_usable_variable" type="object" class="oe_stat_button" icon="fa-file-excel-o">
                            <div class="o_stat_info">
                                <span class="o_stat_value">
                                    Fields
                                </span>
                                <span class="o_stat_text">
                                    Download
                                </span>
                            </div>
                        </button>
                        <button groups="odoo_base.group_freight_technical_support_team" name="download_usable_variable_technical" type="object" class="oe_stat_button" icon="fa-file-excel-o">
                            <div class="o_stat_info">
                                <span class="o_stat_value">
                                    Tech Fields
                                </span>
                                <span class="o_stat_text">
                                    Download
                                </span>
                            </div>
                        </button>
                    </div>
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1><field name="name" class="oe_inline"/></h1>
                    </div>
                    <group>
                        <group>
                            <field name="report_id" readonly="1" groups="base.group_no_one"/>
                            <field invisible="1" name="usable_variable_file" filename="usable_variable_filename" widget="binary" readonly="1"/>
                            <field name="usable_variable_filename" invisible="1"/>
                            <field invisible="1" name="usable_variable_technical_file" filename="usable_variable_technical_filename" widget="binary" readonly="1"/>
                            <field name="usable_variable_technical_filename" invisible="1"/>
                            <field name="res_model_id" string="Module" options="{'no_create': True, 'no_create_edit': True}" required="1"/>
                            <field name="output_type"/>
                            <field name="active" widget="boolean_toggle"/>
                        </group>
                        <group>
                            <field name="filename" invisible="1"/>
                            <field name="docx_file" filename="filename" />
                            <field name="model_name" groups="base.group_no_one"/>
                            <field name="lazy_load" widget="boolean_toggle" groups="base.group_no_one"/>
                            <field name="company_ids" widget="many2many_tags" options="{'no_create': True}"/>
                            <field name="view_type"/>
                            <field name="show_wizard"/>
                        </group>
                    </group>
                    <notebook>
                        <page name="technical_user_guide" string="Lazy Loading Document Formating" attrs="{'invisible': [('lazy_load', '=', False)]}">
                            <div>
                                <h1>Document Templating with lazy loading recordset</h1>
                                <p>
                                    You can directly utilize obj.&lt;field_name&gt; with chaining support as that is record set. also below methods are available in case you needed for output formating.
                                </p>
                                <h3>Jinja Templating</h3>
                                <p>You can design your template with object and jinja2 templating syntax</p>
                                <h3>Loading Images</h3>
                                <p>To load images use method <code>load_image(doc, image_base64)</code></p>
                                <p>Here, <code>doc</code> is current document object you need to pass directly.</p>
                                <code>
                                    {{load_image(doc, obj.company_id.logo_128)}}
                                </code>
                                <h3>Converting HTML to Text</h3>
                                <p>To convert any HTML to text use <code>html_to_text(html_content)</code> method</p>
                                <code>
                                    {{html_to_text(obj.terms_and_conditions)}}
                                </code>
                                <h3>Currency Value with Symbol</h3>
                                <p>By default, any currency/Monetary value will not be printed with symbols you need to use <code>amount_with_currency(obj, amount, [currency_field='currency_id'])</code></p>
                                <p>Here, <code>currency_field</code> is optional if you need to convert in specific field based currency you need to provide</p>
                                <code>
                                    {{amount_with_currency(obj, obj.total_amount)}}
                                </code>
                                <h3>Selection Value Label instead of key</h3>
                                <p>By default, Selection field will print key as value if you need to show label of that key use <code>selection_value(obj, field_name)</code></p>
                                <code>
                                    {{selection_value(obj, 'state')}}
                                </code>
                                <h3>Format Date and Datetime as per settings</h3>
                                <p>To format your date and datetime based on settings use <code>format_date(date)</code> and <code>format_datetime(datetime)</code></p>
                                <code>
                                    {{format_date(obj.shipment_date)}}
                                    {{format_datetime(obj.create_date)}}
                                </code>
                            </div>
                        </page>
                        <page name="excel_user_guide" string="Excel Document Usage" attrs="{'invisible': [('lazy_load', '=', True)]}">
                            <div>
                                <h1>How to use Fields Excel Document</h1>
                                <p>Fields Document (Top right button to download) contains fields list you can use for creating your (.docx) document with dynamic data rendering<br/>
                                It contains, <code>Template Field</code> and it's description. The template field is required to be used in your document to print the value from the record</p>
                                <h4>Possible Template Fields</h4>
                                <ol>
                                    <li>Direct Field - You can directly use this field and print value</li>
                                    <li>Reference Field - You need to access field's property by . (dot) notation</li>
                                    <li>Array Field - You required to create looping to print all the related fields values (each loop become Reference field)</li>
                                </ol>
                                <img src="/base_document_reports/static/src/images/fields_excel_info.png" width="850" alt="User Guide Info"/><br/><br/>
                                <h3>Direct Field</h3>
                                <p>Direct field contains value to be printed on the document. In excel document, those fields are directly writting without any . (dot) notation or Array as in description<br/><br/>
                                <strong>Syntax to Print those field value</strong>:</p>
                                <pre class="text-success h3">{{FieldName}}</pre>
                                <img src="/base_document_reports/static/src/images/direct_fields.png" width="350" alt="Direct Fields"/><br/><br/>
                                <h3>Reference Field</h3>
                                <p>Reference field are linked with another data model where you need to access those field's property by (.dot) notation.<br/>
                                In Excel Document, it will be shown as <code>FieldName.FieldProperty</code>
                                <br/><br/>
                                <strong>Syntax to Print those field value</strong>:</p>
                                <pre class="text-success h3">{{FieldName.FieldProperty}}</pre>
                                <img src="/base_document_reports/static/src/images/reference_fields.png" width="350" alt="Reference Fields"/><br/><br/>
                                <h3>Array Field</h3>
                                <p>Array Fields are generally multiple records and needed to be printed in Table format or in rows format. It is depends on you how you want to print those fields.<br/>
                                When there is a Array field, in description of that field it will be written to follow sheet related to that fields property</p>
                                <p>Like Example, For <span class="text-info">CarrierBookingContainers</span> field the description will be <span class="text-info">"Booking Containers (Array) - See CarrierBookingContainers Sheet"</span></p>
                                <h4>Printing Tables</h4>
                                <p>Tables have dynamic rows to be generated based on fixed or dynamic columns. <br/>For generating dynamic rows and colums below are the syntax</p>
                                <code>{%tr for prop in FieldName %}  &lt;----- Starts with<br/>
        .... access loop property by {{prop}} based on Field type (Direct, Reference)<br/>
        {% endfor %} &lt;----- Ends with
                                </code><br/><br/>
                                <p>Table with dynamic rows:</p>
                                <img src="/base_document_reports/static/src/images/table_dynamic_row.png" width="850" alt="Table Dynamic Row"/><br/><br/>
                                <p>Here, cntr. will map with the reference sheet fields and then you can access those fields directly inside the loop</p>
                                <p class="text-danger">Important: for dynamic rows the red part syntax is must followed.</p>
                                <h4>Printing Rows without Table</h4>
                                <img src="/base_document_reports/static/src/images/array_without_table.png" width="550" alt="Dynamic Row"/><br/><br/>
                                <h4>Conditional Syntax</h4>
                                <pre>Array Field

        {% if Containers %}
        -- if containers are defined --
        {% endif %}

        Direct Field

        {% if CustomBeType == “self” %}
        -- if custom BE Type is ‘self’ --
        {% endif %}

        Reference Field

        {% if CargoType.IsPackageGroup %}
        -- if Cargo Type is package group --
        {% endif %}</pre>
                                <p>Here, any Template field can be used to check if there is a value in it. Follow same syntax for Direct, Reference and Array</p>
                                <a href="/base_document_reports/static/src/documents/report_syntax_sample.docx" target="_new"><span class="fa fa-download mr-2"/>Download Sample</a>
                            </div>
                        </page>
                        <page name="terms_conditions" string="Default Terms &amp; Conditions">
                            <field name="terms_and_conditions" placeholder="Write your Template level Terms &amp; conditions here..."/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="docx_template_view_tree" model="ir.ui.view">
        <field name="name">docx.template.view.tree</field>
        <field name="model">docx.template</field>
        <field name="arch" type="xml">
            <tree string="">
                <field name="name" />
                <field name="res_model_id" />
            </tree>
        </field>
    </record>

    <record id="action_docx_template" model="ir.actions.act_window">
        <field name="name">Docx Report Template</field>
        <field name="res_model">docx.template</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="docx_template_view_tree"/>
    </record>

    <record id="report_type_view_form" model="ir.ui.view">
        <field name="name">report.type.view.form</field>
        <field name="model">report.type</field>
        <field name="arch" type="xml">
            <form string="Report Output Type">
                <sheet>
                    <group>
                        <group>
                            <field name="report_type_id" options="{'no_open': True, 'no_create': True, 'no_create_edit': True}" required="1"/>
                            <field name="has_repeat_count" attrs="{'invisible': [('show_count', '=', False)]}"/>
                            <field name="show_count" invisible="1"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

</odoo>
